<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="es"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AdminController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">ISO2023</a> &gt; <a href="index.source.html" class="el_package">edu.uclm.esi.iso.ISO2023.controllers</a> &gt; <span class="el_source">AdminController.java</span></div><h1>AdminController.java</h1><pre class="source lang-java linenums">package edu.uclm.esi.iso.ISO2023.controllers;

import java.util.*; 

import org.springframework.web.bind.annotation.RestController;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.CrossOrigin;
import org.springframework.web.bind.annotation.DeleteMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.PutMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.server.ResponseStatusException;

import edu.uclm.esi.iso.ISO2023.entities.Cliente;
import edu.uclm.esi.iso.ISO2023.entities.Parametros;
import edu.uclm.esi.iso.ISO2023.entities.Vehiculo;
import edu.uclm.esi.iso.ISO2023.exceptions.numeroInvalido;
import edu.uclm.esi.iso.ISO2023.services.AdminService;
import edu.uclm.esi.iso.ISO2023.services.ClienteService;
import edu.uclm.esi.iso.ISO2023.services.VehiculoService;

@RestController
@RequestMapping(&quot;admin&quot;)
@CrossOrigin(&quot;*&quot;)
<span class="fc" id="L29">public class AdminController {</span>
	@Autowired
	private AdminService adminService;
	@Autowired
	private ClienteService clienteService;
	@Autowired
	private VehiculoService vehiculoService;

	public static final String NOMBRE = &quot;nombre&quot;;
	public static final String PASSWORD = &quot;password&quot;;
	public static final String APELLIDOS = &quot;apellidos&quot;;
	public static final String EMAIL = &quot;email&quot;;
	public static final String BATERIA = &quot;bateria&quot;;
	public static final String DIRECCION = &quot;direccion&quot;;
	public static final String ESTADO = &quot;estado&quot;;
	public static final String MATRICULA = &quot;matricula&quot;;
	public static final String MODELO = &quot;modelo&quot;;
	public static final String TIPO = &quot;tipo&quot;;
	public static final String DISPONIBLE = &quot;disponible&quot;;
	public static final String EMAILUSER = &quot;emailUser&quot;;
	public static final String PASSWORDUSER = &quot;passwordUser&quot;;
	public static final String GET_PAR_ERR = &quot;No se han podido capturar los parámetros de la petición, revíselos.&quot;;

	@PostMapping(&quot;/cliente&quot;)
	public List&lt;Cliente&gt; listaCliente(@RequestBody Map&lt;String, Object&gt; info) {
		String emailAdmin;
		String passwordAdmin;
		try {
<span class="nc" id="L57">			emailAdmin = info.get(EMAILUSER).toString();</span>
<span class="nc" id="L58">			passwordAdmin = info.get(PASSWORDUSER).toString();</span>
<span class="nc" id="L59">		} catch (Exception e) {</span>
<span class="nc" id="L60">			throw new ResponseStatusException(HttpStatus.BAD_REQUEST, GET_PAR_ERR);</span>
<span class="nc" id="L61">		}</span>
<span class="nc" id="L62">		return clienteService.listaClientes(emailAdmin, passwordAdmin);</span>
	}

	@PostMapping(&quot;/vehiculo&quot;)
	public List&lt;Vehiculo&gt; listaVehiculo(@RequestBody Map&lt;String, Object&gt; info) {
		String emailAdmin;
		String passwordAdmin;
		try {
<span class="fc" id="L70">			emailAdmin = info.get(EMAILUSER).toString();</span>
<span class="fc" id="L71">			passwordAdmin = info.get(PASSWORDUSER).toString();</span>
<span class="nc" id="L72">		} catch (Exception e) {</span>
<span class="nc" id="L73">			throw new ResponseStatusException(HttpStatus.BAD_REQUEST, GET_PAR_ERR);</span>
<span class="fc" id="L74">		}</span>
<span class="fc" id="L75">		return vehiculoService.listaVehiculo(emailAdmin, passwordAdmin);</span>
	}

	@PostMapping(&quot;/register&quot;)
	public ResponseEntity&lt;String&gt; registrar(@RequestBody Map&lt;String, Object&gt; info) {
		String password1;
		String nombre;
		String apellidos;
		String email;
		String emailAdmin;
		String passwordAdmin;
		String tipoUsuario;
		try {
<span class="nc" id="L88">			password1 = info.get(&quot;password1&quot;).toString();</span>
<span class="nc" id="L89">			String password2 = info.get(&quot;password2&quot;).toString();</span>

<span class="nc bnc" id="L91" title="All 2 branches missed.">			if (!password1.equals(password2))</span>
<span class="nc" id="L92">				throw new ResponseStatusException(HttpStatus.NOT_ACCEPTABLE, &quot;Las contraseñas no coinciden&quot;);</span>

<span class="nc" id="L94">			nombre = info.get(NOMBRE).toString();</span>
<span class="nc" id="L95">			apellidos = info.get(APELLIDOS).toString();</span>
<span class="nc" id="L96">			email = info.get(EMAIL).toString();</span>
<span class="nc" id="L97">			emailAdmin = info.get(EMAILUSER).toString();</span>
<span class="nc" id="L98">			passwordAdmin = info.get(PASSWORDUSER).toString();</span>
<span class="nc" id="L99">			tipoUsuario = info.get(&quot;tipoUsuario&quot;).toString();</span>
<span class="nc" id="L100">		} catch (Exception e) {</span>
<span class="nc" id="L101">			throw new ResponseStatusException(HttpStatus.BAD_REQUEST, GET_PAR_ERR);</span>
<span class="nc" id="L102">		}</span>

		try {
<span class="nc bnc" id="L105" title="All 2 branches missed.">			if (tipoUsuario.equals(&quot;admin&quot;))</span>
<span class="nc" id="L106">				this.adminService.registrar(nombre, apellidos, email, password1, emailAdmin, passwordAdmin,</span>
						tipoUsuario);
<span class="nc bnc" id="L108" title="All 2 branches missed.">			if (tipoUsuario.equals(&quot;mantenimiento&quot;))</span>
<span class="nc" id="L109">				this.adminService.registrar(nombre, apellidos, email, password1, emailAdmin, passwordAdmin,</span>
						tipoUsuario);
<span class="nc" id="L111">		} catch (Exception e) {</span>
<span class="nc" id="L112">			throw new ResponseStatusException(HttpStatus.CONFLICT, e.getMessage());</span>
<span class="nc" id="L113">		}</span>
<span class="nc" id="L114">		return ResponseEntity.ok(&quot;Registro realizado con éxito.&quot;);</span>
	}

	@PutMapping(&quot;/actualizarCliente&quot;)
	public ResponseEntity&lt;String&gt; actualizarCliente(@RequestBody Map&lt;String, Object&gt; info) {
		String nombre;
		String apellidos;
		String email;
		String password;
		boolean activo;
		int intentos;
		String fechaNacimiento;
		String carnet;
		String telefono;
		String dni;
		String emailAdmin;
		String passwordAdmin;
		try {
<span class="nc" id="L132">			nombre = info.get(NOMBRE).toString();</span>
<span class="nc" id="L133">			apellidos = info.get(APELLIDOS).toString();</span>
<span class="nc" id="L134">			email = info.get(EMAIL).toString();</span>
<span class="nc" id="L135">			password = info.get(PASSWORD).toString();</span>
<span class="nc" id="L136">			activo = Boolean.parseBoolean(info.get(&quot;activo&quot;).toString());</span>
<span class="nc" id="L137">			intentos = Integer.parseInt(info.get(&quot;intentos&quot;).toString());</span>
<span class="nc" id="L138">			fechaNacimiento = info.get(&quot;fechaNacimiento&quot;).toString();</span>
<span class="nc" id="L139">			carnet = info.get(&quot;carnet&quot;).toString();</span>
<span class="nc" id="L140">			telefono = info.get(&quot;telefono&quot;).toString();</span>
<span class="nc" id="L141">			dni = info.get(&quot;dni&quot;).toString();</span>
<span class="nc" id="L142">			emailAdmin = info.get(EMAILUSER).toString();</span>
<span class="nc" id="L143">			passwordAdmin = info.get(PASSWORDUSER).toString();</span>
<span class="nc" id="L144">		} catch (NumberFormatException e) {</span>
<span class="nc" id="L145">			throw new ResponseStatusException(HttpStatus.BAD_REQUEST, GET_PAR_ERR);</span>
<span class="nc" id="L146">		}</span>

		try {
<span class="nc" id="L149">			this.clienteService.actualizarCliente(nombre, apellidos, email, password, activo, intentos, fechaNacimiento,</span>
					carnet, telefono, dni, emailAdmin, passwordAdmin);
<span class="nc" id="L151">		} catch (Exception e) {</span>
<span class="nc" id="L152">			throw new ResponseStatusException(HttpStatus.CONFLICT, e.getMessage());</span>
<span class="nc" id="L153">		}</span>
<span class="nc" id="L154">		return ResponseEntity.ok(&quot;Actualizacion realizada con éxito.&quot;);</span>
	}

	@DeleteMapping(&quot;/eliminarAdmin&quot;)
	public ResponseEntity&lt;String&gt; eliminarAdmin(@RequestBody Map&lt;String, Object&gt; info) {
		String email;
		String emailAdmin;
		String passwordAdmin;
		try {
<span class="nc" id="L163">			email = info.get(EMAIL).toString();</span>
<span class="nc" id="L164">			emailAdmin = info.get(EMAILUSER).toString();</span>
<span class="nc" id="L165">			passwordAdmin = info.get(PASSWORDUSER).toString();</span>
<span class="nc" id="L166">		} catch (Exception e) {</span>
<span class="nc" id="L167">			throw new ResponseStatusException(HttpStatus.BAD_REQUEST, GET_PAR_ERR);</span>
<span class="nc" id="L168">		}</span>
		try {
<span class="nc" id="L170">			this.adminService.eliminarAdmin(email, emailAdmin, passwordAdmin);</span>
<span class="nc" id="L171">		} catch (Exception e) {</span>
<span class="nc" id="L172">			throw new ResponseStatusException(HttpStatus.CONFLICT, e.getMessage());</span>
<span class="nc" id="L173">		}</span>
<span class="nc" id="L174">		return ResponseEntity.ok(&quot;Administrador eliminado con éxito.&quot;);</span>
	}

	@DeleteMapping(&quot;/eliminarCliente&quot;)
	public ResponseEntity&lt;String&gt; anularCliente(@RequestBody Map&lt;String, Object&gt; info) {
		String email;
		String emailAdmin;
		String passwordAdmin;
		try {
<span class="nc" id="L183">			email = info.get(EMAIL).toString();</span>
<span class="nc" id="L184">			emailAdmin = info.get(EMAILUSER).toString();</span>
<span class="nc" id="L185">			passwordAdmin = info.get(PASSWORDUSER).toString();</span>
<span class="nc" id="L186">		} catch (Exception e) {</span>
<span class="nc" id="L187">			throw new ResponseStatusException(HttpStatus.BAD_REQUEST, GET_PAR_ERR);</span>
<span class="nc" id="L188">		}</span>
		try {
<span class="nc" id="L190">			this.clienteService.anularCliente(email, emailAdmin, passwordAdmin);</span>
<span class="nc" id="L191">		} catch (Exception e) {</span>
<span class="nc" id="L192">			throw new ResponseStatusException(HttpStatus.CONFLICT, e.getMessage());</span>
<span class="nc" id="L193">		}</span>
<span class="nc" id="L194">		return ResponseEntity.ok(&quot;Cliente eliminado con éxito.&quot;);</span>
	}

	@PostMapping(&quot;/darAltaVehiculo&quot;)
	public ResponseEntity&lt;String&gt; darAltaVehiculo(@RequestBody Map&lt;String, Object&gt; info) throws numeroInvalido {

		String tipoVehiculo;
		try {
<span class="nc" id="L202">			tipoVehiculo = (String) info.get(TIPO);</span>
<span class="nc" id="L203">		} catch (Exception e) {</span>
<span class="nc" id="L204">			throw new ResponseStatusException(HttpStatus.BAD_REQUEST, GET_PAR_ERR);</span>
<span class="nc" id="L205">		}</span>

<span class="nc bnc" id="L207" title="All 4 branches missed.">		switch (tipoVehiculo) {</span>
		case &quot;coche&quot;:
<span class="nc" id="L209">			darAltaCoche(info);</span>
<span class="nc" id="L210">			break;</span>
		case &quot;moto&quot;:
<span class="nc" id="L212">			darAltaMoto(info);</span>
<span class="nc" id="L213">			break;</span>
		case &quot;patinete&quot;:
<span class="nc" id="L215">			darAltaPatinete(info);</span>
<span class="nc" id="L216">			break;</span>
		default:
<span class="nc" id="L218">			return ResponseEntity.badRequest().body(&quot;Tipo de vehículo desconocido.&quot;);</span>
		}
<span class="nc" id="L220">		return ResponseEntity.ok(&quot;Vehículo dado de alta con éxito.&quot;);</span>

	}

	private void darAltaCoche(Map&lt;String, Object&gt; info){
		String matricula;
		String tipo;
		int bateria;
		String modelo;
		String estado;
		String direccion;
		int nPlazas;
		String emailAdmin;
		String passwordAdmin;
		try {
<span class="nc" id="L235">			matricula = info.get(MATRICULA).toString();</span>
<span class="nc" id="L236">			tipo = info.get(TIPO).toString();</span>
<span class="nc" id="L237">			bateria = 100;</span>
<span class="nc" id="L238">			modelo = info.get(MODELO).toString();</span>
<span class="nc" id="L239">			estado = DISPONIBLE;</span>
<span class="nc" id="L240">			direccion = info.get(DIRECCION).toString();</span>
<span class="nc" id="L241">			nPlazas = Integer.parseInt(info.get(&quot;nPlazas&quot;).toString());</span>
<span class="nc" id="L242">			emailAdmin = info.get(EMAILUSER).toString();</span>
<span class="nc" id="L243">			passwordAdmin = info.get(PASSWORDUSER).toString();</span>
<span class="nc" id="L244">		} catch (NumberFormatException e) {</span>
<span class="nc" id="L245">			throw new ResponseStatusException(HttpStatus.BAD_REQUEST, GET_PAR_ERR);</span>
<span class="nc" id="L246">		}</span>

<span class="nc" id="L248">		this.vehiculoService.darAltaCoche(matricula, tipo, bateria, modelo, estado, direccion, nPlazas, emailAdmin,</span>
				passwordAdmin);

<span class="nc" id="L251">	}</span>

	private void darAltaMoto(Map&lt;String, Object&gt; info) {

		String matricula;
		String tipo;
		int bateria;
		String modelo;
		String estado;
		String direccion;
		boolean casco;
		String emailAdmin;
		String passwordAdmin;
		try {
<span class="nc" id="L265">			matricula = info.get(MATRICULA).toString();</span>
<span class="nc" id="L266">			tipo = info.get(TIPO).toString();</span>
<span class="nc" id="L267">			bateria = 100;</span>
<span class="nc" id="L268">			modelo = info.get(MODELO).toString();</span>
<span class="nc" id="L269">			estado = DISPONIBLE;</span>
<span class="nc" id="L270">			direccion = info.get(DIRECCION).toString();</span>
<span class="nc" id="L271">			casco = Boolean.parseBoolean(info.get(&quot;casco&quot;).toString());</span>
<span class="nc" id="L272">			emailAdmin = info.get(EMAILUSER).toString();</span>
<span class="nc" id="L273">			passwordAdmin = info.get(PASSWORDUSER).toString();</span>
<span class="nc" id="L274">		} catch (Exception e) {</span>
<span class="nc" id="L275">			throw new ResponseStatusException(HttpStatus.BAD_REQUEST, GET_PAR_ERR);</span>
<span class="nc" id="L276">		}</span>

<span class="nc" id="L278">		this.vehiculoService.darAltaMoto(matricula, tipo, bateria, modelo, estado, direccion, casco, emailAdmin,</span>
				passwordAdmin);
<span class="nc" id="L280">	}</span>

	private void darAltaPatinete(Map&lt;String, Object&gt; info) {

		String matricula;
		String tipo;
		int bateria;
		String modelo;
		String estado;
		String direccion;
		String color;
		String emailAdmin;
		String passwordAdmin;
		try {
<span class="nc" id="L294">			matricula = info.get(MATRICULA).toString();</span>
<span class="nc" id="L295">			tipo = info.get(TIPO).toString();</span>
<span class="nc" id="L296">			bateria = 100;</span>
<span class="nc" id="L297">			modelo = info.get(MODELO).toString();</span>
<span class="nc" id="L298">			estado = DISPONIBLE;</span>
<span class="nc" id="L299">			direccion = info.get(DIRECCION).toString();</span>
<span class="nc" id="L300">			color = info.get(&quot;color&quot;).toString();</span>
<span class="nc" id="L301">			emailAdmin = info.get(EMAILUSER).toString();</span>
<span class="nc" id="L302">			passwordAdmin = info.get(PASSWORDUSER).toString();</span>
<span class="nc" id="L303">		} catch (Exception e) {</span>
<span class="nc" id="L304">			throw new ResponseStatusException(HttpStatus.BAD_REQUEST, GET_PAR_ERR);</span>
<span class="nc" id="L305">		}</span>

<span class="nc" id="L307">		this.vehiculoService.darAltaPatinete(matricula, tipo, bateria, modelo, estado, direccion, color, emailAdmin,</span>
				passwordAdmin);
<span class="nc" id="L309">	}</span>

	@DeleteMapping(&quot;/darBajaVehiculo&quot;)
	public ResponseEntity&lt;String&gt; darBajaVehiculo(@RequestBody Map&lt;String, Object&gt; info) {
		String emailAdmin;
		String passwordAdmin;
		String id;
		try {
<span class="nc" id="L317">			emailAdmin = info.get(EMAILUSER).toString();</span>
<span class="nc" id="L318">			passwordAdmin = info.get(PASSWORDUSER).toString();</span>
<span class="nc" id="L319">			id = info.get(&quot;id&quot;).toString();</span>
<span class="nc" id="L320">		} catch (Exception e) {</span>
<span class="nc" id="L321">			throw new ResponseStatusException(HttpStatus.BAD_REQUEST, GET_PAR_ERR);</span>
<span class="nc" id="L322">		}</span>
<span class="nc" id="L323">		vehiculoService.darBajaVehiculo(id, emailAdmin, passwordAdmin);</span>
<span class="nc" id="L324">		return ResponseEntity.ok(&quot;Vehículo dado de baja con éxito.&quot;);</span>
	}

	@PutMapping(&quot;/actualizarVehiculo&quot;)
	public ResponseEntity&lt;String&gt; actualizarVehiculo(@RequestBody Map&lt;String, Object&gt; info) {
		String tipoVehiculo;
		try {
<span class="nc" id="L331">			tipoVehiculo = (String) info.get(TIPO);</span>
<span class="nc" id="L332">		} catch (Exception e) {</span>
<span class="nc" id="L333">			throw new ResponseStatusException(HttpStatus.BAD_REQUEST, GET_PAR_ERR);</span>
<span class="nc" id="L334">		}</span>

<span class="nc bnc" id="L336" title="All 4 branches missed.">		switch (tipoVehiculo) {</span>
		case &quot;coche&quot;:
<span class="nc" id="L338">			modificarCoche(info);</span>
<span class="nc" id="L339">			break;</span>
		case &quot;moto&quot;:
<span class="nc" id="L341">			modificarMoto(info);</span>
<span class="nc" id="L342">			break;</span>
		case &quot;patinete&quot;:
<span class="nc" id="L344">			modificarPatinete(info);</span>
<span class="nc" id="L345">			break;</span>
		default:
<span class="nc" id="L347">			return ResponseEntity.badRequest().body(&quot;Tipo de vehículo desconocido.&quot;);</span>
		}
<span class="nc" id="L349">		return ResponseEntity.ok(&quot;Vehículo modificado con éxito.&quot;);</span>
	}

	public void modificarCoche(Map&lt;String, Object&gt; info) {
		String id;
		String matricula;
		String tipo;
		int bateria;
		String modelo;
		String estado;
		String direccion;
		String emailAdmin;
		String passwordAdmin;
		int nPlazas;
		try {
<span class="nc" id="L364">			id = info.get(&quot;id&quot;).toString();</span>
<span class="nc" id="L365">			matricula = info.get(MATRICULA).toString();</span>
<span class="nc" id="L366">			tipo = info.get(TIPO).toString();</span>
<span class="nc" id="L367">			bateria = Integer.parseInt(info.get(BATERIA).toString());</span>
<span class="nc" id="L368">			modelo = info.get(MODELO).toString();</span>
<span class="nc" id="L369">			estado = info.get(ESTADO).toString();</span>
<span class="nc" id="L370">			direccion = info.get(DIRECCION).toString();</span>
<span class="nc" id="L371">			emailAdmin = info.get(EMAILUSER).toString();</span>
<span class="nc" id="L372">			passwordAdmin = info.get(PASSWORDUSER).toString();</span>
<span class="nc" id="L373">			nPlazas = Integer.parseInt(info.get(&quot;nPlazas&quot;).toString());</span>
<span class="nc" id="L374">		} catch (NumberFormatException e) {</span>
<span class="nc" id="L375">			throw new ResponseStatusException(HttpStatus.BAD_REQUEST, GET_PAR_ERR);</span>
<span class="nc" id="L376">		}</span>
		try {
<span class="nc" id="L378">			this.vehiculoService.modificarCoche(id, matricula, tipo, bateria, modelo, estado, direccion, emailAdmin,</span>
					passwordAdmin, nPlazas);
<span class="nc" id="L380">		} catch (Exception e) {</span>
<span class="nc" id="L381">			throw new ResponseStatusException(HttpStatus.CONFLICT, e.getMessage());</span>
<span class="nc" id="L382">		}</span>
<span class="nc" id="L383">	}</span>

	public void modificarMoto(Map&lt;String, Object&gt; info) {
		String id;
		String matricula;
		String tipo;
		int bateria;
		String modelo;
		String estado;
		String direccion;
		String emailAdmin;
		String passwordAdmin;
		boolean casco;
		try {
<span class="nc" id="L397">			id = info.get(&quot;id&quot;).toString();</span>
<span class="nc" id="L398">			matricula = info.get(MATRICULA).toString();</span>
<span class="nc" id="L399">			tipo = info.get(TIPO).toString();</span>
<span class="nc" id="L400">			bateria = Integer.parseInt(info.get(BATERIA).toString());</span>
<span class="nc" id="L401">			modelo = info.get(MODELO).toString();</span>
<span class="nc" id="L402">			estado = info.get(ESTADO).toString();</span>
<span class="nc" id="L403">			direccion = info.get(DIRECCION).toString();</span>
<span class="nc" id="L404">			emailAdmin = info.get(EMAILUSER).toString();</span>
<span class="nc" id="L405">			passwordAdmin = info.get(PASSWORDUSER).toString();</span>
<span class="nc" id="L406">			casco = Boolean.parseBoolean(info.get(&quot;casco&quot;).toString());</span>
<span class="nc" id="L407">		} catch (NumberFormatException e) {</span>
<span class="nc" id="L408">			throw new ResponseStatusException(HttpStatus.BAD_REQUEST, GET_PAR_ERR);</span>
<span class="nc" id="L409">		}</span>
		try {
<span class="nc" id="L411">			this.vehiculoService.modificarMoto(id, matricula, tipo, bateria, modelo, estado, direccion, emailAdmin,</span>
					passwordAdmin, casco);
<span class="nc" id="L413">		} catch (Exception e) {</span>
<span class="nc" id="L414">			throw new ResponseStatusException(HttpStatus.CONFLICT, e.getMessage());</span>
<span class="nc" id="L415">		}</span>
<span class="nc" id="L416">	}</span>

	public void modificarPatinete(Map&lt;String, Object&gt; info) {
		String id;
		String matricula;
		String tipo;
		int bateria;
		String modelo;
		String estado;
		String direccion;
		String emailAdmin;
		String passwordAdmin;
		String color;
		try {
<span class="nc" id="L430">			id = info.get(&quot;id&quot;).toString();</span>
<span class="nc" id="L431">			matricula = info.get(MATRICULA).toString();</span>
<span class="nc" id="L432">			tipo = info.get(TIPO).toString();</span>
<span class="nc" id="L433">			bateria = Integer.parseInt(info.get(BATERIA).toString());</span>
<span class="nc" id="L434">			modelo = info.get(MODELO).toString();</span>
<span class="nc" id="L435">			estado = info.get(ESTADO).toString();</span>
<span class="nc" id="L436">			direccion = info.get(DIRECCION).toString();</span>
<span class="nc" id="L437">			emailAdmin = info.get(EMAILUSER).toString();</span>
<span class="nc" id="L438">			passwordAdmin = info.get(PASSWORDUSER).toString();</span>
<span class="nc" id="L439">			color = info.get(&quot;color&quot;).toString();</span>
<span class="nc" id="L440">		} catch (NumberFormatException e) {</span>
<span class="nc" id="L441">			throw new ResponseStatusException(HttpStatus.BAD_REQUEST, GET_PAR_ERR);</span>
<span class="nc" id="L442">		}</span>
		try {
<span class="nc" id="L444">			this.vehiculoService.modificarPatinete(id, matricula, tipo, bateria, modelo, estado, direccion, emailAdmin,</span>
					passwordAdmin, color);
<span class="nc" id="L446">		} catch (Exception e) {</span>
<span class="nc" id="L447">			throw new ResponseStatusException(HttpStatus.CONFLICT, e.getMessage());</span>
<span class="nc" id="L448">		}</span>
<span class="nc" id="L449">	}</span>

	@PostMapping(&quot;/getParametros&quot;)
	public Parametros getParametros(@RequestBody Map&lt;String, Object&gt; info) {
		String emailAdmin;
		String passwordAdmin;
		try {
<span class="nc" id="L456">			emailAdmin = info.get(EMAILUSER).toString();</span>
<span class="nc" id="L457">			passwordAdmin = info.get(PASSWORDUSER).toString();</span>
<span class="nc" id="L458">		} catch (Exception e) {</span>
<span class="nc" id="L459">			throw new ResponseStatusException(HttpStatus.BAD_REQUEST, GET_PAR_ERR);</span>
<span class="nc" id="L460">		}</span>
		try {
<span class="nc" id="L462">			return this.adminService.getParametros(emailAdmin, passwordAdmin);</span>
<span class="nc" id="L463">		} catch (Exception e) {</span>
<span class="nc" id="L464">			throw new ResponseStatusException(HttpStatus.CONFLICT, e.getMessage());</span>
		}
	}

	@PutMapping(&quot;/actualizarParametros&quot;)
	public void actualizarParametros(@RequestBody Map&lt;String, Object&gt; info) {
		double precioViaje;
		int minimoBateria;
		int bateriaViaje;
		int maxVehiculosMantenimiento;
		String emailAdmin;
		String passwordAdmin;
		try {
<span class="nc" id="L477">			precioViaje = Double.parseDouble(info.get(&quot;precioViaje&quot;).toString());</span>
<span class="nc" id="L478">			minimoBateria = Integer.parseInt(info.get(&quot;minimoBateria&quot;).toString());</span>
<span class="nc" id="L479">			bateriaViaje = Integer.parseInt(info.get(&quot;bateriaViaje&quot;).toString());</span>
<span class="nc" id="L480">			maxVehiculosMantenimiento = Integer.parseInt(info.get(&quot;maxVehiculosMantenimiento&quot;).toString());</span>
<span class="nc" id="L481">			emailAdmin = info.get(EMAILUSER).toString();</span>
<span class="nc" id="L482">			passwordAdmin = info.get(PASSWORDUSER).toString();</span>
<span class="nc" id="L483">		} catch (NumberFormatException e) {</span>
<span class="nc" id="L484">			throw new ResponseStatusException(HttpStatus.BAD_REQUEST, GET_PAR_ERR);</span>
<span class="nc" id="L485">		}</span>

		try {
<span class="nc" id="L488">			this.adminService.actualizarParametros(precioViaje, minimoBateria, bateriaViaje, maxVehiculosMantenimiento,</span>
					emailAdmin, passwordAdmin);
<span class="nc" id="L490">		} catch (Exception e) {</span>
<span class="nc" id="L491">			throw new ResponseStatusException(HttpStatus.CONFLICT, e.getMessage());</span>
<span class="nc" id="L492">		}</span>
<span class="nc" id="L493">	}</span>

	@PostMapping(&quot;/obtenerFacturacion&quot;)
	public List&lt;String&gt; obtenerFacturacion(@RequestBody Map&lt;String, Object&gt; info) {
		String emailAdmin;
		String passwordAdmin;
		String primerDia;
		String ultimoDia;
		try {
<span class="nc" id="L502">			emailAdmin = info.get(EMAILUSER).toString();</span>
<span class="nc" id="L503">			passwordAdmin = info.get(PASSWORDUSER).toString();</span>
<span class="nc" id="L504">			primerDia = info.get(&quot;primerDia&quot;).toString();</span>
<span class="nc" id="L505">			ultimoDia = info.get(&quot;ultimoDia&quot;).toString();</span>
<span class="nc" id="L506">		} catch (Exception e) {</span>
<span class="nc" id="L507">			throw new ResponseStatusException(HttpStatus.BAD_REQUEST, GET_PAR_ERR);</span>
<span class="nc" id="L508">		}</span>
		try {
<span class="nc" id="L510">			return this.adminService.obtenerFacturacion(emailAdmin, passwordAdmin, primerDia, ultimoDia);</span>
<span class="nc" id="L511">		} catch (Exception e) {</span>
<span class="nc" id="L512">			throw new ResponseStatusException(HttpStatus.CONFLICT, e.getMessage());</span>
		}
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>