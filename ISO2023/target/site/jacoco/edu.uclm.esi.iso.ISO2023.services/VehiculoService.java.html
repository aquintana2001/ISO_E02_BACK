<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="es"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>VehiculoService.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">ISO2023</a> &gt; <a href="index.source.html" class="el_package">edu.uclm.esi.iso.ISO2023.services</a> &gt; <span class="el_source">VehiculoService.java</span></div><h1>VehiculoService.java</h1><pre class="source lang-java linenums">package edu.uclm.esi.iso.ISO2023.services;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.stereotype.Service;
import org.springframework.web.server.ResponseStatusException;
import java.util.Optional;

import edu.uclm.esi.iso.ISO2023.dao.ParametrosDAO;
import edu.uclm.esi.iso.ISO2023.dao.VehiculoDAO;
import edu.uclm.esi.iso.ISO2023.entities.Coche;
import edu.uclm.esi.iso.ISO2023.entities.Moto;
import edu.uclm.esi.iso.ISO2023.entities.Parametros;
import edu.uclm.esi.iso.ISO2023.entities.Patinete;
import edu.uclm.esi.iso.ISO2023.entities.Vehiculo;
import java.util.Collections;

@Service
<span class="fc" id="L21">public class VehiculoService {</span>
	@Autowired
	private UserService userService;
	@Autowired
	private VehiculoDAO vehiculoDAO;
	@Autowired
	private ParametrosDAO parametrosDAO;

	public static final String ERROR_VE = &quot;Ese vehiculo ya existe&quot;;
	public static final String ID_BBDD = &quot;655b1a3db7bb7908becebbf4&quot;;
	public static final String ADMIN = &quot;admin&quot;;

	public List&lt;Vehiculo&gt; listaVehiculo(String email, String password) {
<span class="fc" id="L34">		Optional&lt;Parametros&gt; parametros = parametrosDAO.findById(ID_BBDD);</span>
<span class="pc bpc" id="L35" title="1 of 2 branches missed.">		if (parametros.isPresent()) {</span>
<span class="fc bfc" id="L36" title="All 2 branches covered.">			if (userService.checkUser(email, password).equals(ADMIN)) {</span>
<span class="fc" id="L37">				return this.vehiculoDAO.findAll();</span>
<span class="fc bfc" id="L38" title="All 2 branches covered.">			} else if (userService.checkUser(email, password).equals(&quot;cliente&quot;)) {</span>
<span class="fc" id="L39">				return this.vehiculoDAO.findByBateriaGreaterThanEqualAndEstadoEquals(parametros.get().getMinimoBateria(),</span>
						&quot;disponible&quot;);
<span class="pc bpc" id="L41" title="1 of 2 branches missed.">			} else if (userService.checkUser(email, password).equals(&quot;mantenimiento&quot;)) {</span>
<span class="fc" id="L42">				return this.vehiculoDAO.findByBateriaLessThanAndEstadoEquals(parametros.get().getMinimoBateria(),</span>
						&quot;descargado&quot;);
			} else {
<span class="nc" id="L45">				throw new ResponseStatusException(HttpStatus.FORBIDDEN,</span>
						&quot;No tienes permisos para realizar esta accion.&quot;);
			}
		}
<span class="nc" id="L49">		return Collections.emptyList();</span>
	}

	public void darAltaCoche(String matricula, String tipo, int bateria, String modelo, String estado, String direccion,
			int nPlazas, String emailAdmin, String passwordAdmin){
<span class="nc bnc" id="L54" title="All 2 branches missed.">		if (userService.checkUser(emailAdmin, passwordAdmin).equals(ADMIN)) {</span>
<span class="nc" id="L55">			Coche coche = new Coche(tipo, matricula, bateria, modelo, estado, direccion, nPlazas);</span>

<span class="nc" id="L57">			Optional&lt;Vehiculo&gt; possibleVehiculo = this.vehiculoDAO.findByMatricula(matricula);</span>

<span class="nc bnc" id="L59" title="All 2 branches missed.">			if (!possibleVehiculo.isPresent()) {</span>
<span class="nc" id="L60">				this.vehiculoDAO.save(coche);</span>
			} else {
<span class="nc" id="L62">				throw new ResponseStatusException(HttpStatus.FORBIDDEN, ERROR_VE);</span>
			}
		}
<span class="nc" id="L65">	}</span>

	public void darAltaMoto(String matricula, String tipo, int bateria, String modelo, String estado, String direccion,
			boolean casco, String emailAdmin, String passwordAdmin)  {
<span class="nc bnc" id="L69" title="All 2 branches missed.">		if (userService.checkUser(emailAdmin, passwordAdmin).equals(ADMIN)) {</span>
<span class="nc" id="L70">			Moto moto = new Moto(tipo, matricula, bateria, modelo, estado, direccion, casco);</span>
<span class="nc" id="L71">			Optional&lt;Vehiculo&gt; possibleVehiculo = this.vehiculoDAO.findByMatricula(matricula);</span>

<span class="nc bnc" id="L73" title="All 2 branches missed.">			if (!possibleVehiculo.isPresent()) {</span>
<span class="nc" id="L74">				this.vehiculoDAO.save(moto);</span>
			} else {
<span class="nc" id="L76">				throw new ResponseStatusException(HttpStatus.FORBIDDEN, ERROR_VE);</span>
			}
		}
<span class="nc" id="L79">	}</span>

	public void darAltaPatinete(String matricula, String tipo, int bateria, String modelo, String estado,
			String direccion, String color, String emailAdmin, String passwordAdmin) {
<span class="nc bnc" id="L83" title="All 2 branches missed.">		if (userService.checkUser(emailAdmin, passwordAdmin).equals(ADMIN)) {</span>
<span class="nc" id="L84">			Patinete patinete = new Patinete(tipo, matricula, bateria, modelo, estado, direccion, color);</span>
<span class="nc" id="L85">			Optional&lt;Vehiculo&gt; possibleVehiculo = this.vehiculoDAO.findByMatricula(matricula);</span>

<span class="nc bnc" id="L87" title="All 2 branches missed.">			if (!possibleVehiculo.isPresent()) {</span>
<span class="nc" id="L88">				this.vehiculoDAO.save(patinete);</span>
			} else {
<span class="nc" id="L90">				throw new ResponseStatusException(HttpStatus.FORBIDDEN, ERROR_VE);</span>
			}
		}
<span class="nc" id="L93">	}</span>

	public void darBajaVehiculo(String id, String emailAdmin, String passwordAdmin) {
<span class="nc bnc" id="L96" title="All 2 branches missed.">		if (userService.checkUser(emailAdmin, passwordAdmin).equals(ADMIN)) {</span>
<span class="nc bnc" id="L97" title="All 2 branches missed.">			if (vehiculoExist(id)) {</span>
<span class="nc" id="L98">				vehiculoDAO.deleteById(id);</span>
			} else {
<span class="nc" id="L100">				throw new ResponseStatusException(HttpStatus.FORBIDDEN, &quot;Ese vehiculo no existe&quot;);</span>
			}
		}
<span class="nc" id="L103">	}</span>

	public boolean vehiculoExist(String id) {

<span class="nc" id="L107">		return this.vehiculoDAO.findById(id).isPresent();</span>

	}

	public void modificarCoche(String id, String matricula, String tipo, int bateria, String modelo, String estado,
			String direccion, String emailAdmin, String passwordAdmin, int nPlazas) {
<span class="nc bnc" id="L113" title="All 2 branches missed.">		if (userService.checkUser(emailAdmin, passwordAdmin).equals(ADMIN)) {</span>
<span class="nc" id="L114">			Optional&lt;Vehiculo&gt; vehiculoExiste = vehiculoDAO.findById(id);</span>
<span class="nc bnc" id="L115" title="All 2 branches missed.">			if (vehiculoExiste.isPresent()) {</span>
<span class="nc" id="L116">				Vehiculo vehiculo = vehiculoExiste.get();</span>
<span class="nc" id="L117">				Coche coche = (Coche) vehiculo;</span>
<span class="nc" id="L118">				coche.setMatricula(matricula);</span>
<span class="nc" id="L119">				coche.setTipo(tipo);</span>
<span class="nc" id="L120">				coche.setBateria(bateria);</span>
<span class="nc" id="L121">				coche.setModelo(modelo);</span>
<span class="nc" id="L122">				coche.setEstado(estado);</span>
<span class="nc" id="L123">				coche.setDireccion(direccion);</span>
<span class="nc" id="L124">				coche.setnPlaza(nPlazas);</span>
<span class="nc" id="L125">				this.vehiculoDAO.save(coche);</span>
			}
		}
<span class="nc" id="L128">	}</span>

	public void modificarMoto(String id, String matricula, String tipo, int bateria, String modelo, String estado,
			String direccion, String emailAdmin, String passwordAdmin, boolean casco) {
<span class="nc bnc" id="L132" title="All 2 branches missed.">		if (userService.checkUser(emailAdmin, passwordAdmin).equals(ADMIN)) {</span>
<span class="nc" id="L133">			Optional&lt;Vehiculo&gt; vehiculoExiste = vehiculoDAO.findById(id);</span>
<span class="nc bnc" id="L134" title="All 2 branches missed.">			if (vehiculoExiste.isPresent()) {</span>
<span class="nc" id="L135">				Vehiculo vehiculo = vehiculoExiste.get();</span>
<span class="nc" id="L136">				Moto moto = (Moto) vehiculo;</span>
<span class="nc" id="L137">				moto.setMatricula(matricula);</span>
<span class="nc" id="L138">				moto.setTipo(tipo);</span>
<span class="nc" id="L139">				moto.setBateria(bateria);</span>
<span class="nc" id="L140">				moto.setModelo(modelo);</span>
<span class="nc" id="L141">				moto.setEstado(estado);</span>
<span class="nc" id="L142">				moto.setDireccion(direccion);</span>
<span class="nc" id="L143">				moto.setCasco(casco);</span>
<span class="nc" id="L144">				this.vehiculoDAO.save(moto);</span>
			}
		}
<span class="nc" id="L147">	}</span>

	public void modificarPatinete(String id, String matricula, String tipo, int bateria, String modelo, String estado,
			String direccion, String emailAdmin, String passwordAdmin, String color) {
<span class="nc bnc" id="L151" title="All 2 branches missed.">		if (userService.checkUser(emailAdmin, passwordAdmin).equals(ADMIN)) {</span>
<span class="nc" id="L152">			Optional&lt;Vehiculo&gt; vehiculoExiste = vehiculoDAO.findById(id);</span>
<span class="nc bnc" id="L153" title="All 2 branches missed.">			if (vehiculoExiste.isPresent()) {</span>
<span class="nc" id="L154">				Vehiculo vehiculo = vehiculoExiste.get();</span>
<span class="nc" id="L155">				Patinete patinete = (Patinete) vehiculo;</span>
<span class="nc" id="L156">				patinete.setMatricula(matricula);</span>
<span class="nc" id="L157">				patinete.setTipo(tipo);</span>
<span class="nc" id="L158">				patinete.setBateria(bateria);</span>
<span class="nc" id="L159">				patinete.setModelo(modelo);</span>
<span class="nc" id="L160">				patinete.setEstado(estado);</span>
<span class="nc" id="L161">				patinete.setDireccion(direccion);</span>
<span class="nc" id="L162">				patinete.setColor(color);</span>
<span class="nc" id="L163">				this.vehiculoDAO.save(patinete);</span>
			}
		}
<span class="nc" id="L166">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>